<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>SleepBrain — Artigos</title>
  <link rel="stylesheet" href="/assets/css/sb-global.css">
  <link rel="stylesheet" href="/assets/css/sb-header.css">
  <link rel="stylesheet" href="/assets/css/sb-artigos.css">
</head>
<body>
  <div id="header-placeholder"></div>

  <main class="container">
    <div class="artigos-header">
      <h1>Conteúdo sobre sono</h1>
      <button class="sb-btn" id="btn-novo-artigo"><i class="fas fa-plus-circle"></i> Publicar</button>
    </div>

    <div class="grid artigos-grid" id="artigos-grid"></div>
  </main>

  <dialog id="dlg-artigo" class="sb-card" style="border:none;padding:0;max-width:640px;width:96%">
    <form id="formCreateArticle" method="dialog" style="padding:16px">
      <h3 style="margin:0 0 8px 0">Novo artigo</h3>
      <div class="form-row">
        <label>Título</label><input class="input" name="titulo" required>
      </div>
      <div class="form-row">
        <label>Descrição</label><textarea class="input" name="descricao" rows="3" required></textarea>
      </div>
      <div class="form-row">
        <label>URL do artigo</label><input class="input" name="url" type="url" required>
      </div>
      <div class="form-row">
        <label>Fonte (opcional)</label><input class="input" name="fonte">
      </div>
      <input type="hidden" name="autor_id" id="articleAutorId">
      <p id="modal-article-msg" class="form-msg"></p>
      <div class="auth-actions">
        <button type="button" class="sb-btn sb-btn--secondary" id="dlg-cancel">Cancelar</button>
        <button type="submit" class="sb-btn" id="btnPublicarArtigo">Publicar</button>
      </div>
    </form>
  </dialog>

  <script src="/script.js"></script>
  <script>
    (function(){
      // script.js carregará o header E o chat (via bootChat)
      carregarHeader('header-placeholder', getUser());

      // Lógica específica da página
      const btn = document.getElementById('btn-novo-artigo');
      const dlg = document.getElementById('dlg-artigo');
      const cancel = document.getElementById('dlg-cancel');
      btn.addEventListener('click', () => {
        const u = getUser(); if(!u){ showToast('Faça login para publicar.','error'); return; }
        document.getElementById('articleAutorId').value = u.id;
        dlg.showModal();
      });
      cancel.addEventListener('click', () => dlg.close());

      inicializarFormularioArtigo();
      carregarArtigos();
    })();
  </script>
</body>
</html>